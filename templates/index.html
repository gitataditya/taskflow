<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TaskFlow Enterprise - Python Edition</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}" />
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a class="navbar-brand" href="/">ğŸš€ TaskFlow Enterprise</a>
            <ul class="navbar-nav">
                <li><a class="nav-link" href="/">ğŸ“Š Dashboard</a></li>
                <li><span class="nav-link">ğŸ Python Edition</span></li>
            </ul>
        </div>
    </nav>

    <div class="main-container">
        <div class="page-header">
            <h1 class="page-title">ğŸš€ TaskFlow Enterprise</h1>
            <p class="text-muted">Complete task management solution with modern Python Flask backend</p>
        </div>

        <!-- Horizontal Tab Navigation -->
        <div class="tab-container">
            <ul class="nav-tabs">
                <li class="nav-item">
                    <button class="nav-tab active" data-tab="dashboard">
                        ğŸ“Š Dashboard
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-tab" data-tab="create">
                        â• Create Task
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-tab" data-tab="manage">
                        ğŸ“‹ Manage Tasks
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-tab" data-tab="analytics">
                        ğŸ“ˆ Analytics
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-tab" data-tab="settings">
                        âš™ï¸ Settings
                    </button>
                </li>
            </ul>
        </div>

        <!-- Tab Content Areas -->
        <div class="tab-content">
            
            <!-- Dashboard Tab -->
            <div id="dashboard-tab" class="tab-pane active">
                <!-- Dashboard Stats -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="stats-number text-primary">{{ total_tasks }}</div>
                            <div class="stats-label">Total Tasks</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="stats-number text-success">{{ completed_tasks }}</div>
                            <div class="stats-label">Completed</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="stats-number text-warning">{{ pending_tasks }}</div>
                            <div class="stats-label">In Progress</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stats-card">
                            <div class="stats-number text-info">{{ completion_rate }}%</div>
                            <div class="stats-label">Completion Rate</div>
                        </div>
                    </div>
                </div>

                <!-- Recent Tasks -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">ğŸ“ Recent Tasks</h5>
                    </div>
                    <div class="card-body" style="padding: 0;">
                        {% if tasks %}
                            {% for task in tasks[:5] %}
                            <div class="task-item">
                                <div class="task-content">
                                    <div class="form-check">
                                        <input class="form-check-input" 
                                               type="checkbox" 
                                               {% if task.is_completed %}checked{% endif %}
                                               onchange="toggleTaskCompletion({{ task.id }})">
                                    </div>
                                    <div style="flex: 1;">
                                        <div class="task-title {% if task.is_completed %}text-decoration-line-through text-muted{% endif %}">
                                            {{ task.title }}
                                        </div>
                                        <div class="task-meta">
                                            <span>ğŸ“… {{ task.created_at.strftime('%b %d, %Y') }}</span>
                                        </div>
                                    </div>
                                </div>
                                <span class="badge {% if task.is_completed %}bg-success{% else %}bg-warning{% endif %}">
                                    {% if task.is_completed %}âœ… Done{% else %}â³ Pending{% endif %}
                                </span>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="empty-state">
                                <div class="empty-state-icon">ğŸ“</div>
                                <h3>No Tasks Yet</h3>
                                <p class="text-muted">Click "Create Task" tab to get started!</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Create Task Tab -->
            <div id="create-tab" class="tab-pane">
                <div class="create-task-container">
                    <div class="create-task-header">
                        <div class="create-task-title">
                            <div class="create-task-icon">â•</div>
                            <div>
                                <h2>Create New Task</h2>
                                <p>Add a new task to your workflow and stay organized</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="create-task-form">
                        <form id="createTaskForm">
                            <div class="form-section">
                                <div class="form-group-large">
                                    <label class="form-label-large">ğŸ“„ Task Title *</label>
                                    <input id="taskTitle" 
                                           class="form-control-large" 
                                           placeholder="Enter a clear and descriptive title for your task..."
                                           required />
                                    <div class="form-hint">Make it specific and actionable</div>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <div class="form-group-large">
                                    <label class="form-label-large">ğŸ“ Description</label>
                                    <textarea id="taskDescription" 
                                              class="form-control-large textarea-large" 
                                              rows="6" 
                                              placeholder="Describe the task in detail. Include any requirements, steps, or important notes that will help you complete this task successfully..."></textarea>
                                    <div class="form-hint">Add context, requirements, deadlines, or any other relevant information</div>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <div class="form-row">
                                    <div class="form-group-half">
                                        <label class="form-label-large">ğŸ¯ Priority Level</label>
                                        <select id="taskPriority" class="form-control-large">
                                            <option value="Low">ğŸŸ¢ Low Priority - No rush</option>
                                            <option value="Medium" selected>ğŸŸ¡ Medium Priority - Normal timeline</option>
                                            <option value="High">ğŸ”´ High Priority - Urgent</option>
                                        </select>
                                        <div class="form-hint">Set the urgency level for this task</div>
                                    </div>
                                    
                                    <div class="form-group-half">
                                        <label class="form-label-large">ğŸ“… Category</label>
                                        <select id="taskCategory" class="form-control-large">
                                            <option value="Work">ğŸ’¼ Work</option>
                                            <option value="Personal" selected>ğŸ‘¤ Personal</option>
                                            <option value="Health">ğŸ¥ Health</option>
                                            <option value="Learning">ğŸ“š Learning</option>
                                            <option value="Finance">ğŸ’° Finance</option>
                                            <option value="Other">ğŸ“Œ Other</option>
                                        </select>
                                        <div class="form-hint">Organize your tasks by category</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" onclick="clearForm()" class="btn-secondary-large">
                                    ğŸ”„ Clear Form
                                </button>
                                <button type="submit" class="btn-primary-large" id="createBtn">
                                    ğŸš€ Create Task
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Manage Tasks Tab -->
            <div id="manage-tab" class="tab-pane">
                <div class="card">
                    <div class="card-header manage-header">
                        <div class="manage-title">
                            <h5 class="mb-0">ğŸ“‹ Manage All Tasks</h5>
                            <p class="manage-subtitle">Filter, sort, and organize your tasks</p>
                        </div>
                        <div class="manage-controls">
                            <!-- Filter Buttons -->
                            <div class="filter-group">
                                <label class="filter-label">Filter by Status</label>
                                <div class="filter-buttons">
                                    <button class="filter-btn active" data-filter="all" onclick="setFilter('all')">
                                        <span class="filter-icon">ğŸ“‹</span>
                                        <span class="filter-text">All Tasks</span>
                                        <span class="filter-count" id="count-all">0</span>
                                    </button>
                                    <button class="filter-btn" data-filter="pending" onclick="setFilter('pending')">
                                        <span class="filter-icon">â³</span>
                                        <span class="filter-text">In Progress</span>
                                        <span class="filter-count" id="count-pending">0</span>
                                    </button>
                                    <button class="filter-btn" data-filter="completed" onclick="setFilter('completed')">
                                        <span class="filter-icon">âœ…</span>
                                        <span class="filter-text">Completed</span>
                                        <span class="filter-count" id="count-completed">0</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Sort Control -->
                            <div class="sort-group">
                                <label class="sort-label">Sort Order</label>
                                <div class="sort-select-wrapper">
                                    <select class="sort-select" id="sortTasks">
                                        <option value="newest">ğŸ—“ï¸ Newest First</option>
                                        <option value="oldest">ğŸ“… Oldest First</option>
                                        <option value="title">ğŸ”¤ By Title</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body" style="padding: 0;">
                        {% if tasks %}
                            <div id="tasksList">
                                {% for task in tasks %}
                                <div class="task-item" 
                                     data-status="{% if task.is_completed %}completed{% else %}pending{% endif %}" 
                                     data-title="{{ task.title.lower() }}" 
                                     data-date="{{ task.created_at.strftime('%Y-%m-%d') }}"
                                     data-task-id="{{ task.id }}">
                                    <div class="task-content">
                                        <div class="form-check">
                                            <input class="form-check-input" 
                                                   type="checkbox" 
                                                   {% if task.is_completed %}checked{% endif %}
                                                   onchange="toggleTaskCompletion({{ task.id }})">
                                        </div>
                                        <div style="flex: 1;">
                                            <div class="task-title {% if task.is_completed %}text-decoration-line-through text-muted{% endif %}">
                                                {{ task.title }}
                                            </div>
                                            {% if task.description %}
                                            <div class="task-description">{{ task.description }}</div>
                                            {% endif %}
                                            <div class="task-meta">
                                                <span>ğŸ“… Created: {{ task.created_at.strftime('%b %d, %Y') }}</span>
                                                {% if task.is_completed and task.completed_at %}
                                                <span class="text-success">âœ… Completed: {{ task.completed_at.strftime('%b %d, %Y') }}</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-center gap-2">
                                        <span class="badge {% if task.is_completed %}bg-success{% else %}bg-warning{% endif %}">
                                            {% if task.is_completed %}âœ… Completed{% else %}â³ In Progress{% endif %}
                                        </span>
                                        <div class="task-actions">
                                            <button class="btn btn-sm btn-outline-primary" 
                                                    onclick="editTask({{ task.id }}, '{{ task.title|replace("'", "\\'") }}', '{{ (task.description or '')|replace("'", "\\'") }}', {{ task.is_completed|lower }})" 
                                                    title="Edit Task">
                                                âœï¸
                                            </button>
                                            <button class="btn btn-sm btn-outline-danger" onclick="deleteTask({{ task.id }})" title="Delete Task">
                                                ğŸ—‘ï¸
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="empty-state">
                                <div class="empty-state-icon">ğŸ“</div>
                                <h3>No Tasks Found</h3>
                                <p class="text-muted">Switch to "Create Task" tab to add your first task!</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div id="analytics-tab" class="tab-pane">
                <!-- Main Stats Cards -->
                <div class="analytics-stats-grid mb-5">
                    <div class="analytics-stat-card">
                        <div class="analytics-stat-icon text-primary">ğŸ“‹</div>
                        <div class="analytics-stat-number text-primary">{{ total_tasks }}</div>
                        <div class="analytics-stat-label">Total Tasks</div>
                        <div class="analytics-stat-description">All tasks created</div>
                    </div>
                    <div class="analytics-stat-card">
                        <div class="analytics-stat-icon text-success">âœ…</div>
                        <div class="analytics-stat-number text-success">{{ completed_tasks }}</div>
                        <div class="analytics-stat-label">Completed</div>
                        <div class="analytics-stat-description">Tasks finished</div>
                    </div>
                    <div class="analytics-stat-card">
                        <div class="analytics-stat-icon text-warning">â³</div>
                        <div class="analytics-stat-number text-warning">{{ pending_tasks }}</div>
                        <div class="analytics-stat-label">In Progress</div>
                        <div class="analytics-stat-description">Tasks remaining</div>
                    </div>
                    <div class="analytics-stat-card">
                        <div class="analytics-stat-icon text-info">ğŸ“ˆ</div>
                        <div class="analytics-stat-number text-info">{{ completion_rate }}%</div>
                        <div class="analytics-stat-label">Success Rate</div>
                        <div class="analytics-stat-description">Completion ratio</div>
                    </div>
                </div>

                <!-- Technology Stack -->
                <div class="card analytics-tech-card">
                    <div class="card-header">
                        <h5 class="mb-0">ğŸ› ï¸ Technology Stack</h5>
                        <p class="text-muted mb-0">Powered by modern Python technologies</p>
                    </div>
                    <div class="card-body">
                        <div class="tech-grid">
                            <div class="tech-item">
                                <div class="tech-icon">âš¡</div>
                                <div class="tech-content">
                                    <h6>Flask Framework</h6>
                                    <p>Lightweight web framework</p>
                                </div>
                            </div>
                            <div class="tech-item">
                                <div class="tech-icon">ğŸ—ƒï¸</div>
                                <div class="tech-content">
                                    <h6>SQLAlchemy ORM</h6>
                                    <p>Database abstraction layer</p>
                                </div>
                            </div>
                            <div class="tech-item">
                                <div class="tech-icon">ğŸ“Š</div>
                                <div class="tech-content">
                                    <h6>SQLite Database</h6>
                                    <p>Embedded database engine</p>
                                </div>
                            </div>
                            <div class="tech-item">
                                <div class="tech-icon">ğŸ¨</div>
                                <div class="tech-content">
                                    <h6>Jinja2 Templates</h6>
                                    <p>Template engine for Python</p>
                                </div>
                            </div>
                            <div class="tech-item">
                                <div class="tech-icon">ğŸš€</div>
                                <div class="tech-content">
                                    <h6>REST API</h6>
                                    <p>RESTful endpoints</p>
                                </div>
                            </div>
                            <div class="tech-item">
                                <div class="tech-icon">ğŸ“±</div>
                                <div class="tech-content">
                                    <h6>Responsive Design</h6>
                                    <p>Mobile-friendly interface</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings-tab" class="tab-pane">
                <!-- Theme Settings Card -->
                <div class="settings-card mb-4">
                    <div class="settings-header">
                        <div class="settings-title">
                            <div class="settings-icon">ğŸ¨</div>
                            <div>
                                <h5>Theme Preferences</h5>
                                <p>Customize your visual experience</p>
                            </div>
                        </div>
                    </div>
                    <div class="settings-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <label class="setting-label">Color Theme</label>
                                <p class="setting-description">Choose your preferred color scheme</p>
                            </div>
                            <div class="setting-control">
                                <select class="form-select" id="themeSelect" onchange="changeTheme()">
                                    <option value="default">ğŸ”µ Default Blue</option>
                                    <option value="dark">ğŸŒ™ Dark Mode</option>
                                    <option value="light">â˜€ï¸ Light Mode</option>
                                    <option value="green">ğŸŸ¢ Nature Green</option>
                                    <option value="purple">ğŸŸ£ Royal Purple</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- System Information Card -->
                <div class="settings-card mb-4">
                    <div class="settings-header">
                        <div class="settings-title">
                            <div class="settings-icon">ğŸ</div>
                            <div>
                                <h5>System Information</h5>
                                <p>Technology stack and runtime details</p>
                            </div>
                        </div>
                    </div>
                    <div class="settings-body">
                        <div class="info-grid">
                            <div class="info-item">
                                <div class="info-label">Framework</div>
                                <div class="info-value">Flask 3.0.0</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Database</div>
                                <div class="info-value">SQLAlchemy + SQLite</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Template Engine</div>
                                <div class="info-value">Jinja2</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Status</div>
                                <div class="info-value status-running">ğŸŸ¢ Running</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Actions Card -->
                <div class="settings-card">
                    <div class="settings-header">
                        <div class="settings-title">
                            <div class="settings-icon">ğŸ”„</div>
                            <div>
                                <h5>Data Management</h5>
                                <p>Import, export, and manage your tasks</p>
                            </div>
                        </div>
                    </div>
                    <div class="settings-body">
                        <div class="actions-grid">
                            <div class="action-item">
                                <button class="btn btn-action btn-export" onclick="exportTasks()">
                                    <div class="btn-icon">ğŸ“¤</div>
                                    <div class="btn-content">
                                        <div class="btn-title">Export Tasks</div>
                                        <div class="btn-description">Download your tasks as JSON</div>
                                    </div>
                                </button>
                            </div>
                            <div class="action-item">
                                <button class="btn btn-action btn-import" onclick="importTasks()">
                                    <div class="btn-icon">ğŸ“¥</div>
                                    <div class="btn-content">
                                        <div class="btn-title">Import Tasks</div>
                                        <div class="btn-description">Upload tasks from file</div>
                                    </div>
                                </button>
                            </div>
                            <div class="action-item">
                                <button class="btn btn-action btn-clear" onclick="clearAllTasks()">
                                    <div class="btn-icon">ğŸ—‘ï¸</div>
                                    <div class="btn-content">
                                        <div class="btn-title">Clear All Tasks</div>
                                        <div class="btn-description">Remove all tasks permanently</div>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Task Modal -->
        <div id="editModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h5>âœï¸ Edit Task</h5>
                    <button class="close-btn" onclick="closeEditModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="editTaskForm">
                        <input type="hidden" id="editTaskId">
                        <div class="mb-3">
                            <label class="form-label">ğŸ“„ Task Title</label>
                            <input id="editTaskTitle" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ğŸ“ Description</label>
                            <textarea id="editTaskDescription" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input type="checkbox" id="editTaskCompleted" class="form-check-input">
                                <label class="form-check-label">âœ… Mark as completed</label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" onclick="closeEditModal()">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveTaskEdit()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab functionality
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Python Flask TaskFlow - Tab system initializing...');
            const tabs = document.querySelectorAll('.nav-tab');
            const tabPanes = document.querySelectorAll('.tab-pane');
            
            // Ensure only dashboard is visible initially
            tabPanes.forEach(pane => {
                pane.classList.remove('active');
                pane.style.display = 'none';
            });
            document.getElementById('dashboard-tab').classList.add('active');
            document.getElementById('dashboard-tab').style.display = 'block';
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetTab = this.dataset.tab;
                    
                    // Remove active from all tabs and panes
                    tabs.forEach(t => t.classList.remove('active'));
                    tabPanes.forEach(pane => {
                        pane.classList.remove('active');
                        pane.style.display = 'none';
                    });
                    
                    // Add active to clicked tab and corresponding pane
                    this.classList.add('active');
                    const targetPane = document.getElementById(targetTab + '-tab');
                    if (targetPane) {
                        targetPane.classList.add('active');
                        targetPane.style.display = 'block';
                    }
                });
            });

            // Form submissions
            document.getElementById('createTaskForm').addEventListener('submit', createTask);
            
            // Filter and sort functionality
            const filterSelect = document.getElementById('filterTasks');
            const sortSelect = document.getElementById('sortTasks');
            
            if (filterSelect) filterSelect.addEventListener('change', filterTasks);
            if (sortSelect) sortSelect.addEventListener('change', sortTasks);
        });

        // Create task function
        async function createTask(e) {
            e.preventDefault();
            
            const title = document.getElementById('taskTitle').value.trim();
            const description = document.getElementById('taskDescription').value.trim();
            
            if (!title) {
                alert('Please enter a task title.');
                return;
            }
            
            const createBtn = document.getElementById('createBtn');
            createBtn.disabled = true;
            createBtn.innerHTML = 'â³ Creating...';
            
            try {
                const response = await fetch('/api/tasks', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title: title,
                        description: description
                    })
                });
                
                if (response.ok) {
                    alert('âœ… Task created successfully!');
                    clearForm();
                    window.location.reload();
                } else {
                    alert('âŒ Failed to create task. Please try again.');
                }
            } catch (error) {
                console.error('Error creating task:', error);
                alert('âŒ An error occurred. Please try again.');
            } finally {
                createBtn.disabled = false;
                createBtn.innerHTML = 'ğŸš€ Create Task';
            }
        }

        function clearForm() {
            document.getElementById('taskTitle').value = '';
            document.getElementById('taskDescription').value = '';
            document.getElementById('taskPriority').value = 'Medium';
            document.getElementById('taskCategory').value = 'Personal';
        }

        // Toggle task completion
        async function toggleTaskCompletion(taskId) {
            try {
                const response = await fetch(`/api/tasks/${taskId}/complete`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    window.location.reload();
                } else {
                    alert('Failed to update task status.');
                }
            } catch (error) {
                console.error('Error updating task:', error);
                alert('An error occurred.');
            }
        }

        // Delete task
        async function deleteTask(taskId) {
            if (!confirm('ğŸ—‘ï¸ Are you sure you want to delete this task?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/tasks/${taskId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    window.location.reload();
                } else {
                    alert('Failed to delete task.');
                }
            } catch (error) {
                console.error('Error deleting task:', error);
                alert('An error occurred.');
            }
        }

        // Edit task modal
        function editTask(id, title, description, isCompleted) {
            document.getElementById('editTaskId').value = id;
            document.getElementById('editTaskTitle').value = title;
            document.getElementById('editTaskDescription').value = description;
            document.getElementById('editTaskCompleted').checked = isCompleted;
            document.getElementById('editModal').style.display = 'flex';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        async function saveTaskEdit() {
            const id = document.getElementById('editTaskId').value;
            const title = document.getElementById('editTaskTitle').value.trim();
            const description = document.getElementById('editTaskDescription').value.trim();
            const isCompleted = document.getElementById('editTaskCompleted').checked;
            
            if (!title) {
                alert('Please enter a task title.');
                return;
            }
            
            try {
                const response = await fetch(`/api/tasks/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title: title,
                        description: description,
                        is_completed: isCompleted
                    })
                });
                
                if (response.ok) {
                    alert('âœ… Task updated successfully!');
                    closeEditModal();
                    window.location.reload();
                } else {
                    alert('âŒ Failed to update task.');
                }
            } catch (error) {
                console.error('Error updating task:', error);
                alert('âŒ An error occurred.');
            }
        }

        // Filter and sort functions
        function setFilter(filterValue) {
            const tasks = document.querySelectorAll('.task-item[data-status]');
            const filterButtons = document.querySelectorAll('.filter-btn');
            
            // Update active button
            filterButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-filter') === filterValue) {
                    btn.classList.add('active');
                }
            });
            
            // Filter tasks
            tasks.forEach(task => {
                const status = task.getAttribute('data-status');
                if (filterValue === 'all' || filterValue === status) {
                    task.style.display = '';
                } else {
                    task.style.display = 'none';
                }
            });
        }
        
        function filterTasks() {
            // This is kept for backward compatibility with the select dropdown
            const filterValue = document.getElementById('filterTasks')?.value || 'all';
            setFilter(filterValue);
        }
        
        // Update task counts
        function updateTaskCounts() {
            const tasks = document.querySelectorAll('.task-item[data-status]');
            const allCount = tasks.length;
            const pendingCount = document.querySelectorAll('.task-item[data-status=\"pending\"]').length;
            const completedCount = document.querySelectorAll('.task-item[data-status=\"completed\"]').length;
            
            const countAll = document.getElementById('count-all');
            const countPending = document.getElementById('count-pending');
            const countCompleted = document.getElementById('count-completed');
            
            if (countAll) countAll.textContent = allCount;
            if (countPending) countPending.textContent = pendingCount;
            if (countCompleted) countCompleted.textContent = completedCount;
        }

        function sortTasks() {
            const sortValue = document.getElementById('sortTasks').value;
            const tasksList = document.getElementById('tasksList');
            const tasks = Array.from(document.querySelectorAll('.task-item[data-status]'));
            
            tasks.sort((a, b) => {
                switch (sortValue) {
                    case 'oldest':
                        return new Date(a.getAttribute('data-date')) - new Date(b.getAttribute('data-date'));
                    case 'title':
                        return a.getAttribute('data-title').localeCompare(b.getAttribute('data-title'));
                    case 'newest':
                    default:
                        return new Date(b.getAttribute('data-date')) - new Date(a.getAttribute('data-date'));
                }
            });
            
            tasksList.innerHTML = '';
            tasks.forEach(task => tasksList.appendChild(task));
        }

        // Settings functions
        function exportTasks() {
            alert('ğŸ“¤ Export functionality coming soon!');
        }

        function importTasks() {
            alert('ğŸ“¥ Import functionality coming soon!');
        }

        function clearAllTasks() {
            if (confirm('ğŸ—‘ï¸ Are you sure you want to delete all tasks? This cannot be undone.')) {
                alert('ğŸ”„ Clear all tasks functionality coming soon!');
            }
        }

        // Theme functionality
        function changeTheme() {
            const theme = document.getElementById('themeSelect').value;
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('selectedTheme', theme);
        }

        // Load saved theme on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('selectedTheme') || 'default';
            document.documentElement.setAttribute('data-theme', savedTheme);
            const themeSelect = document.getElementById('themeSelect');
            if (themeSelect) {
                themeSelect.value = savedTheme;
            }
            
            // Initialize task counts
            updateTaskCounts();
        });
    </script>
</body>
</html>